{% load static %}
{% block body %}
{% include 'user_navigation.html' %}

<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card shadow-lg border-0 rounded-lg">
                <div class="card-header bg-primary text-white text-center">
                    <h3 class="font-weight-light my-2">My Profile</h3>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <div class="row">
                            <!-- Profile Image Section -->
                            <div class="col-md-4 text-center mb-4">
                                <div class="mb-3">
                                    {% if student.image %}
                                        <img src="{{student.image.url}}" class="img-fluid rounded-circle shadow" style="width: 200px; height: 200px; object-fit: cover;" alt="Profile Image">
                                    {% else %}
                                        <img src="{% static 'images/default_user.png' %}" class="img-fluid rounded-circle shadow" style="width: 200px; height: 200px; object-fit: cover;" alt="Default Profile">
                                    {% endif %}
                                </div>
                                <div class="form-group">
                                    <label for="image" class="btn btn-outline-primary btn-sm">
                                        <i class="fas fa-camera mr-1"></i> Change Photo
                                        <input type="file" id="image" name="image" accept="image/*" style="display: none;" onchange="this.form.submit()">
                                    </label>
                                </div>
                            </div>

                            <!-- Personal Details Section -->
                            <div class="col-md-8">
                                <h5 class="text-primary mb-3 border-bottom pb-2">Personal Information</h5>
                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label class="small mb-1 font-weight-bold">First Name</label>
                                        <input type="text" class="form-control" name="fname" value="{{student.user.first_name}}" required>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label class="small mb-1 font-weight-bold">Last Name</label>
                                        <input type="text" class="form-control" name="lname" value="{{student.user.last_name}}" required>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label class="small mb-1 font-weight-bold">Contact Number</label>
                                        <input type="text" class="form-control" name="contact" value="{{student.mobile}}" required>
                                    </div>
                                    <div class="form-group col-md-6">
                                        <label class="small mb-1 font-weight-bold">Email Address</label>
                                        <input type="email" class="form-control" value="{{student.user.username}}" readonly disabled>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="small mb-1 font-weight-bold">Gender</label>
                                    <div class="d-block">
                                        <div class="custom-control custom-radio custom-control-inline">
                                            <input type="radio" id="genderMale" name="gender" class="custom-control-input" value="Male" {% if student.gender == "Male" %}checked{% endif %}>
                                            <label class="custom-control-label" for="genderMale">Male</label>
                                        </div>
                                        <div class="custom-control custom-radio custom-control-inline">
                                            <input type="radio" id="genderFemale" name="gender" class="custom-control-input" value="Female" {% if student.gender == "Female" %}checked{% endif %}>
                                            <label class="custom-control-label" for="genderFemale">Female</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Professional Details Section -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <h5 class="text-primary mb-3 border-bottom pb-2">Professional Details</h5>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="small mb-1 font-weight-bold">Experience (Years/Description)</label>
                                    <input type="text" class="form-control" name="experience" value="{{student.experience|default:''}}" placeholder="e.g., 2 years in Web Dev">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="small mb-1 font-weight-bold">Skills</label>
                                    <input type="text" class="form-control" name="skills" value="{{student.skills|default:''}}" placeholder="e.g., Python, Django, React">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="small mb-1 font-weight-bold">Portfolio/Social Link</label>
                                    <input type="url" class="form-control" name="social" value="{{student.social_link|default:''}}" placeholder="https://linkedin.com/in/...">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="small mb-1 font-weight-bold">Resume</label>
                                    <div class="custom-file">
                                        <input type="file" class="custom-file-input" id="resume" name="resume" accept=".pdf,.doc,.docx">
                                        <label class="custom-file-label" for="resume">Choose file...</label>
                                    </div>
                                    {% if student.resume %}
                                        <small class="form-text text-muted mt-2">
                                            Current Resume: <a href="{{student.resume.url}}" target="_blank" class="text-info"><i class="fas fa-file-alt mr-1"></i>View Resume</a>
                                        </small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="form-group mt-4 mb-0 text-center">
                            <button type="submit" class="btn btn-primary btn-lg px-5 shadow-sm">Update Profile</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{% include 'footer.html' %}

{% if error == "no" %}
<script>
    alert("Profile Updated Successfully");
    window.location = ('{% url "user_home" %}');
</script>
{% endif %}

{% if error == "yes" %}
<script>
    alert("Something went wrong, Please try Again...");
</script>
{% endif %}

<script>
    // Add the following code if you want the name of the file appear on select
    $(".custom-file-input").on("change", function() {
      var fileName = $(this).val().split("\\").pop();
      $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
    });
</script>

{% endblock %}